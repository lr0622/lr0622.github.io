<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			ul{
				margin:0;
				padding:0;
				list-style: none;
				width: 660px;
				margin:50px auto;
			}
			li{
				width: 150px;
				height: 150px;
				border:2px solid #fff;
				float: left;
				background-size: 100%;
				margin-right:10px;
				margin-bottom: 10px;
			}
			img{width: 100%;height: 100%;}
			.active{border: 2px solid red;}
		</style>
	</head>
	<body>
		<input type="button" value="随机排序" id="btn"/>
		<ul>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
		
	</body>
</html>
<script src="move4.js"></script>
<script>
	var oBtn = document.getElementById('btn');
	var oUl = document.getElementsByTagName('ul')[0];
	var aLi = oUl.children;
	var pics = ['img/1.jpg','img/2.jpg','img/3.jpg','img/4.jpg','img/5.jpg','img/6.jpg','img/7.jpg','img/8.jpg','img/9.jpg','img/10.jpg','img/11.jpg','img/12.jpg'];
	var arr = [];
	var pos = {};//点击坐标
	var pos2 = {};//点击的li初始坐标
	var pos3 = [];//碰到的li的坐标
	var isDrag = false;
	var isDuang = false;
	for(var i=0;i<aLi.length;i++){
		aLi[i].style.background = 'url('+pics[i]+') no-repeat';
		aLi[i].style.backgroundSize = 'cover';
		arr.push(aLi[i]);
	}
	
	function position(){		
		for(var i=0;i<aLi.length;i++){
			aLi[i].style.left = aLi[i].getBoundingClientRect().left + 'px';
			aLi[i].style.top = aLi[i].getBoundingClientRect().top + 'px';		
		}
		for(var i=0;i<aLi.length;i++){
			aLi[i].style.position = 'absolute';
			aLi[i].style.margin = 0;
		}
	}
	position();	//浮动定位->绝对定位
	document.onmousedown = function(ev){
		pos3 = [];
		pos.x = ev.clientX;//点击坐标
		pos.y = ev.clientY;
		pos2.x = ev.target.getBoundingClientRect().left;//点击的li坐标
		pos2.y = ev.target.getBoundingClientRect().top;
		pos2.e = ev.target;//点击的li
		pos2.b = ev.target.style.background;//点击的li背景
		ev.target.style.zIndex = 99;
		
		if(ev.target.parentNode==oUl){
			isDrag = true;
		}else{
			isDrag = false;
		}
		ev.preventDefault();
	}
	
	document.onmousemove = function(ev){
		pos3 = [];
		if(isDrag){
			var l = ev.clientX;//鼠标当前坐标
			var t = ev.clientY;
			pos2.e.style.left = pos2.x + (l-pos.x) + 'px';//点击的li当前坐标
			pos2.e.style.top = pos2.y + (t-pos.y) + 'px';
			
			for(var j=0;j<aLi.length;j++){
				aLi[j].className = '';
			}
			for(var i=0;i<aLi.length;i++){
				if(ev.target!=aLi[i]){
					if(duang(ev.target,aLi[i])){
						isDuang = true;//碰到
						var el = ev.target.getBoundingClientRect().left;//点击的li当前坐标
						var et = ev.target.getBoundingClientRect().top;
						var al = aLi[i].getBoundingClientRect().left;//碰到的li的坐标
						var at = aLi[i].getBoundingClientRect().top;
						pos3.push({
							x:al,
							y:at,
							s:Math.pow((al-el),2) + Math.pow((at-et),2),//碰到li与点击的li的距离平方
							e:aLi[i]//碰到的li
						})
						aLi[i].className = 'active';
					}
				}
			}
		}
	}
	
	document.onmouseup = function(ev){
		if(pos3.length!=0){
			for(var i=0;i<pos3.length;i++){
				pos3[i].e.className = '';
			}
			pos3.sort(function(a,b){//从小到大  小的距离点击的li最近
				return a.s-b.s;
			})
//			pos3[0].e.style.background = 'red';
			/*pos2.e.style.background = pos3[0].e.style.background;//背景交换
			pos3[0].e.style.background = pos2.b;//碰到的li背景等于已存的点击的li背景*/
			move(pos3[0].e,{left:pos2.x,top:pos2.y},500,'linear');
			move(pos2.e,{left:pos3[0].x,top:pos3[0].y},50,'linear');
			
			/*pos3[0].e.style.left = pos2.x + 'px';
			pos3[0].e.style.top = pos2.y + 'px';
			pos2.e.style.left = pos3[0].x + 'px';
			pos2.e.style.top = pos3[0].y + 'px';*/
			pos2.e.style.zIndex = 0;
			pos3[0].e.style.zIndex = 98;
		}else{
			pos2.e.style.left = pos2.x + 'px';
			pos2.e.style.top = pos2.y + 'px';
			pos2.e.style.zIndex = 0;				
			
		}
		isDrag = false;
		isDuang = false;
	}

	//检测碰撞函数
	function duang(obj1,obj2){
		var pos1 = obj1.getBoundingClientRect();
		var pos2 = obj2.getBoundingClientRect();
		if(pos1.right<pos2.left||pos1.bottom<pos2.top||pos1.left>pos2.right||pos1.top>pos2.bottom){
			return false;
		}else{
			return true;
		}
	}
	
	//随机
	oBtn.onclick = function(){
		pics.sort(function(a,b){
			return Math.random()-0.5;
		})
		newLi();
	}
	
	function newLi(){
		for(var i=0;i<aLi.length;i++){
			aLi[i].style.background = 'url('+pics[i]+') no-repeat';
			aLi[i].style.backgroundSize = 'cover';
		}
	}	

</script>











,{
		'id':61,
		'title':'too',
		'src':'img/tooo/1.jpg'
	},{
		'id':62,
		'title':'too',
		'src':'img/tooo/2.jpg'
	},{
		'id':63,
		'title':'too',
		'src':'img/tooo/3.jpg'
	},{
		'id':64,
		'title':'too',
		'src':'img/tooo/4.jpg'
	},{
		'id':65,
		'title':'too',
		'src':'img/tooo/5.jpg'
	},{
		'id':66,
		'title':'too',
		'src':'img/tooo/6.jpg'
	},{
		'id':67,
		'title':'too',
		'src':'img/tooo/7.jpg'
	},{
		'id':68,
		'title':'too',
		'src':'img/tooo/8.jpg'
	},{
		'id':69,
		'title':'too',
		'src':'img/tooo/9.jpg'
	},{
		'id':70,
		'title':'too',
		'src':'img/tooo/10.jpg'
	},{
		'id':71,
		'title':'too',
		'src':'img/tooo/11.jpg'
	},{
		'id':72,
		'title':'too',
		'src':'img/tooo/12.jpg'
	},{
		'id':73,
		'title':'too',
		'src':'img/tooo/13.jpg'
	},{
		'id':74,
		'title':'too',
		'src':'img/tooo/14.jpg'
	},{
		'id':75,
		'title':'too',
		'src':'img/tooo/15.jpg'
	},{
		'id':76,
		'title':'too',
		'src':'img/tooo/16.jpg'
	},{
		'id':77,
		'title':'too',
		'src':'img/tooo/17.jpg'
	},{
		'id':78,
		'title':'too',
		'src':'img/tooo/18.jpg'
	},{
		'id':79,
		'title':'too',
		'src':'img/tooo/19.jpg'
	},{
		'id':80,
		'title':'too',
		'src':'img/tooo/20.jpg'
	}







